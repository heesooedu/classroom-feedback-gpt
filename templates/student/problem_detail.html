{% extends "base.html" %}
{% block title %}{{ problem.title }} - íŒŒì´ì¬ ìë™ ì±„ì {% endblock %}

{% block head_extra %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"
        crossorigin="anonymous"></script>
{% endblock %}

{% block content %}
<div class="card">
  <h2>{{ problem.title }}</h2>
  <p class="problem-desc">
    {{ problem.description }}
  </p>

  <div class="two-cols">
    <div>
      <h3 class="subheading">ì˜ˆì‹œ ì…ë ¥</h3>
      <pre class="code-block">{{ problem.sample_input or "ì—†ìŒ" }}</pre>
    </div>
    <div>
      <h3 class="subheading">ì˜ˆì‹œ ì¶œë ¥</h3>
      <pre class="code-block">{{ problem.sample_output or "ì—†ìŒ" }}</pre>
    </div>
  </div>

  <p class="text-muted" style="margin-top:8px;">
    ë§Œì : {{ problem.max_score }}ì 
  </p>
</div>

<div class="card">
  <h3>ì½”ë“œ ì‘ì„± ë° ì œì¶œ</h3>
  <form method="post" action="{{ url_for('submit_code', problem_id=problem.id) }}"
        onsubmit="return handleSubmit();">
    <label class="label">íŒŒì´ì¬ ì½”ë“œ</label>
    <div id="editor" class="editor"></div>
    <textarea name="code" id="code-input" style="display:none;"></textarea>

    <div style="margin-top:12px;">
      <button class="btn" type="submit" id="submit-btn">
        ì œì¶œí•˜ê³  ìë™ ì±„ì  ë°›ê¸°
      </button>
      <span id="submit-status" class="text-muted" style="margin-left:8px;"></span>
    </div>
  </form>
</div>







<div class="card">
  <h3>ì´ ë¬¸ì œì— ëŒ€í•œ ë‚´ ì œì¶œ ê¸°ë¡</h3>
  <ul class="list-plain">
    {% for s in submissions %}
      <li class="list-item">
        <a href="{{ url_for('submission_detail', submission_id=s.id) }}" class="list-title">
          ì‹œë„ {{ s.attempt_no }} Â· {{ s.score }}/{{ s.max_score }}ì 
        </a>
        <div class="list-meta">
          {{ s.created_at|kst }}
        </div>
        {% if s.summary %}
          <div class="text-muted">{{ s.summary }}</div>
        {% endif %}
      </li>
    {% else %}
      <li>ì•„ì§ ì œì¶œí•œ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</li>
    {% endfor %}
  </ul>
</div>



<script>
  const editor = ace.edit("editor");
  editor.session.setMode("ace/mode/python");
  editor.setTheme("ace/theme/github");

  // ğŸ”¹íŒŒì´ì¬ì—ì„œ ë„˜ê¸´ initial_codeë¥¼ JS ë¬¸ìì—´ë¡œ ì•ˆì „í•˜ê²Œ ë³€í™˜
  const initialCode = {{ initial_code|default("")|tojson }};
  editor.setValue(initialCode, -1);  // ë§ˆì§€ë§‰ ì œì¶œ ì½”ë“œë¡œ ì—ë””í„° ì±„ìš°ê¸°

  function syncEditor() {
    const textarea = document.getElementById("code-input");
    textarea.value = editor.getValue();
  }

  function handleSubmit() {
    // ì—ë””í„° ë‚´ìš© â†’ textarea ë™ê¸°í™”
    syncEditor();

    const btn = document.getElementById("submit-btn");
    const status = document.getElementById("submit-status");

    if (btn) {
      btn.disabled = true;
      btn.textContent = "ì±„ì  ì¤‘...";
    }
    if (status) {
      status.textContent = "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”. GPTê°€ ì½”ë“œë¥¼ ì±„ì í•˜ê³  ìˆìŠµë‹ˆë‹¤.";
    }

    // í¼ì€ ê·¸ëŒ€ë¡œ ì „ì†¡
    return true;
  }
</script>


{% endblock %}
