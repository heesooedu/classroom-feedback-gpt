# Python 자동 채점 웹 시스템 (고등학교 컴퓨터실용)

이 프로젝트는 **고등학교 정보 / 인공지능 기초 수업**에서 사용할 수 있는  
**파이썬 기초 문법 자동 채점 웹 시스템**입니다.

- 선생님 PC 1대를 **서버**로 사용
- 학생들은 같은 로컬망의 PC에서 **웹브라우저로 접속**
- 학생이 작성한 파이썬 코드를 **GPT API로 자동 채점 + 피드백 생성**
- 학생 / 교사 모두 웹 화면에서 결과 확인

---

## 1. 주요 기능 요약

### 1-1. 학생용

- 학번(5자리, 예: `10101`) + 이름으로 간단 로그인
- 수강 중인 분반(예: `정보 A반`, `인공지능기초 1반`) 선택 후 입장
- **공개된 문제 목록** 조회
- 각 문제 페이지에서
  - 문제 설명, 예시 입·출력, 채점 기준(루브릭) 확인
  - 브라우저에서 파이썬 코드 작성 후 제출
  - GPT가 채점한 **점수와 피드백** 확인
- 한 문제에 대해 여러 번 제출 가능 (최근 24시간 기준으로 제출 횟수 제한)
- 상단 메뉴의 **“내 제출 이력”**에서 각 문제별로 본인 제출 이력 확인

### 1-2. 교사용 (관리자)

- 관리자 계정으로 로그인
- 과목/분반 + 학생 정보를 **CSV 업로드**로 한 번에 등록
  - 예: `정보 A반`, `정보 B반`, `인공지능기초 1반` 등
- 문제 관리
  - 새 문제 등록 / 수정 / 공개 여부 설정
  - 문제 설명, 예시 입출력, 정답 예시 코드, 채점 기준, 만점 점수 등 입력
  - 정답 예시 코드 입력은 **파이썬 전용 코드 에디터(Ace)** 사용
- 대시보드
  - 분반 + 문제를 선택하면, 해당 수업의 **학생별 제출 현황** 확인
  - 각 학생에 대해
    - 제출 여부
    - 제출 횟수
    - 최고 점수 / 만점
    - 마지막 제출 시간
  - 학생의 **제출 코드 + GPT 피드백** 상세 화면으로 이동 가능

---

## 2. 폴더 / 파일 구조 (요약)

실제 구조는 조금 다를 수 있지만, 기본적으로 다음과 비슷합니다.

- `app.py`  
  Flask 애플리케이션 진입점 (서버 실행, 라우트 정의)
- `models.py`  
  SQLAlchemy 모델 정의 (Student, Problem, Submission, ClassGroup, Enrollment, AdminUser 등)
- `get_grader.py`  
  GPT API를 호출하여 채점하는 함수 (`grade_with_gpt`)
- `templates/`  
  HTML 템플릿 (학생용 / 관리자용 화면)
- `static/`  
  CSS, JS, 이미지 등 정적 파일
- `.env`  
  환경변수 파일 (GPT API 키, 관리자 계정 등) — **Git에 올리면 안 됨**
- `requirements.txt`  
  이 프로젝트에 필요한 파이썬 패키지 목록

---

## 3. 사전 준비물

1. **Python 3.10~3.12 정도** 설치 (윈도우 10/11 기준)
2. Git 설치 (이미 학교 PC에 설치되어 있으면 생략)
3. OpenAI 계정 및 **API 키**

---

## 4. 프로젝트 코드 내려받기

### 4-1. GitHub에서 클론 (추천)

1. 웹 브라우저로 이 프로젝트의 GitHub 저장소 페이지로 이동
2. 초록색 `Code` 버튼 클릭 → `HTTPS` 주소 복사
3. 선생님 PC에서 폴더 하나 정하고(예: `C:\programming`) 아래 명령 실행

윈도우 PowerShell 기준 예시:

    cd C:\programming
    git clone <여기에_복사한_GitHub_URL_붙여넣기>
    cd classroom-feedback-gpt   ← 실제 저장소 이름에 맞게 변경

이미 클론을 한 번 받았다면, 다음부터는:

    cd C:\programming\classroom-feedback-gpt
    git pull

로 최신 코드만 가져오면 된다.

---

## 5. 가상환경 생성 및 패키지 설치

**한 번만** 해두면 되고, 이후에는 재사용하면 된다.

### 5-1. 가상환경 만들기

프로젝트 폴더에서:

    cd C:\programming\classroom-feedback-gpt
    python -m venv .venv

폴더 안에 `.venv`라는 가상환경이 생긴다.

### 5-2. 가상환경 활성화

PowerShell 기준:

    cd C:\programming\classroom-feedback-gpt
    .\.venv\Scripts\Activate.ps1

프롬프트 앞에 `(.venv)`가 붙으면 성공.

Command Prompt(cmd.exe)를 쓴다면:

    .\.venv\Scripts\activate.bat

### 5-3. 필요한 패키지 설치

가상환경이 활성화된 상태에서:

    pip install -r requirements.txt

이 명령으로 Flask, SQLAlchemy, openai, waitress 등 이 프로젝트에 필요한 모든 패키지가 설치된다.

---

## 6. 환경변수(.env) 설정

프로젝트 폴더(`app.py`가 있는 위치)에 **`.env` 파일**을 만든다.

내용 예시는 다음과 같다.

    # Flask 비밀키 (아무 문자열이나, 길게)
    SECRET_KEY=change-this-secret-key-123

    # OpenAI API 키 (필수)
    OPENAI_API_KEY=sk-로-시작하는_본인_API_키

    # GPT 모델 이름 (선택, 없으면 코드에서 기본값 사용)
    OPENAI_MODEL=gpt-4.1-mini

    # 관리자 계정 (로그인용)
    ADMIN_USERNAME=teacher
    ADMIN_PASSWORD=teacher1234

주의사항:

- 실제 배포/수업에서는 `ADMIN_USERNAME`, `ADMIN_PASSWORD`, `SECRET_KEY`를  
  **반드시 어렵게** 지정할 것.
- `.env` 파일은 **절대 GitHub에 올리면 안 됩니다!!**

---

## 7. 서버 실행 방법

항상 다음 순서로 실행하면 된다.

1. 가상환경 활성화

    cd C:\programming\classroom-feedback-gpt
    .\.venv\Scripts\Activate.ps1

2. 서버 실행

    python app.py

터미널에 비슷한 메시지가 보이면 성공:

    ✅ Waitress 서버 시작: http://0.0.0.0:8000 에서 대기 중...

3. 브라우저에서 접속

- 선생님 PC에서:  
  주소창에 `http://localhost:8000` 또는 `http://127.0.0.1:8000`
- 같은 로컬망에 있는 학생 PC에서:  
  선생님 PC의 **IP 주소**를 알고 있다면  
  예: 선생님 PC IP가 `10.46.16.100`이라면  
  → `http://10.46.16.100:8000` 으로 접속

---

## 8. 교사 사용 흐름

### 8-1. 관리자 로그인

1. 브라우저에서 `http://선생님PC:8000/admin/login` 접속
2. `.env`에 설정한 `ADMIN_USERNAME`, `ADMIN_PASSWORD`로 로그인

### 8-2. 수업(과목/분반) + 학생 등록 (CSV 업로드)

1. 상단 메뉴에서 **“수업 CSV 등록”** (또는 비슷한 이름의 메뉴) 클릭
2. 과목명 입력 (예: `정보`, `인공지능기초`)
3. 연도, 학기(선택)
4. CSV 파일 업로드

CSV 예시 (UTF-8 권장):

    분반,학번,이름
    A,10101,김일번
    A,10302,김이번
    B,10503,김삼번

- 학번은 5자리 정수 (1학년 1반 1번 → 10101)
- 같은 학생이 여러 분반을 수강할 수도 있음 (Enrollment로 관리)

업로드 후:

- 필요한 학생(Student)이 자동 생성/업데이트
- 분반(ClassGroup) 자동 생성
- 수강 정보(Enrollment) 자동 생성

### 8-3. 문제 만들기

1. 관리자 메뉴에서 **“문제 관리”** → “새 문제 만들기”
2. 제목, 설명, 예시 입력/출력, 정답 예시 코드, 루브릭, 만점 점수 등을 입력
3. “공개” 체크 시 학생의 문제 목록에 표시
4. 정답 예시 코드 입력 칸은 **파이썬용 코드 에디터(Ace)**로 문법 하이라이트 지원

### 8-4. 대시보드에서 진행 상황 확인

1. 관리자 메뉴 → **“대시보드”**
2. 상단에서
   - 수업(과목 + 분반) 선택
   - 문제 선택
3. 아래표에서 각 학생의
   - 제출 여부
   - 최고 점수 / 만점
   - 제출 횟수
   - 마지막 제출 시간
   을 확인하고, “자세히” 버튼으로 제출 코드와 GPT 피드백을 열람 가능

---

## 9. 학생 사용 흐름

1. 브라우저에서 `http://선생님PC의 IP:8000` 접속
2. “학생 입장하기” 또는 “학생 로그인” 클릭
3. 로그인 화면에서
   - 학번(5자리, 예: `10101`)
   - 이름
   을 입력

4. 이 학생이 수강 중인 수업(분반)이 하나면 → 바로 그 수업으로 입장  
   둘 이상이면 → 수업 선택 화면에서 선택

5. 상단 메뉴 “문제 목록”에서 공개된 문제 확인
6. 문제를 클릭하면:
   - 문제 설명 / 예시 입출력 / 채점 기준 확인
   - 코드 에디터에 파이썬 코드 작성 후 **제출**
   - 잠시 기다리면 점수 + 피드백 표시
7. 상단 메뉴 **“내 제출 이력”**에서 각 문제별로 제출 기록 확인 가능

---

## 10. 데이터 초기화(처음부터 다시 쓰고 싶을 때)

### 10-1. 전체 제출/학생/수업 정보 초기화

가장 간단한 방법은 **SQLite DB 파일을 삭제**하고,  
서버를 다시 실행하여 새로 생성하게 하는 것이다.

1. 서버 종료 (터미널에서 Ctrl + C)
2. 프로젝트 폴더에서 `autograder_v2.db` 파일 삭제

    cd C:\programming\classroom-feedback-gpt
    del autograder_v2.db

3. 다시 서버 실행

    python app.py

4. 관리자 로그인 후, 다시 CSV 업로드 / 문제 등록 진행

※ `.env` 파일은 그대로 두면, 관리자 계정과 GPT 키는 그대로 재사용된다.

## 또는..
1. (.venv) python reset_class_data.py
터미널에 위와 같이 입력하여 학기 데이터 초기화(문제는 남아있습니다)

2. (.venv) python reset_db.py
문제도 포함하여 전체 날리고 싶다면 터미널에 위와 같이 입력


---

## 11. requirements.txt 관리 팁

- 현재 `requirements.txt`는 **이 프로젝트가 정상 동작하는 상태**를 기준으로  
  `pip freeze` 한 결과를 넣어두는 것을 권장
- 만약 패키지를 하나 더 설치했다면 (예: `pip install waitress`):
  - 가상환경이 활성화된 상태에서

    pip freeze > requirements.txt

  - 를 다시 실행하여 최신 상태로 갱신할 수 있다.

이렇게 해 두면:

- 다른 PC에서
  - `git clone` → `.venv` 생성 → `pip install -r requirements.txt` → `python app.py`
- 만으로 거의 동일한 환경을 재현할 수 있다.
